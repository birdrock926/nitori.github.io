---
import type { Media } from '@lib/strapi';
const { items = [] } = Astro.props as {
  items?: { image: Media; alt?: string; displayMode?: 'auto' | 'image' | 'gif' }[];
};
---
{items.length > 0 && (
  <section class="card gallery-card">
    <div class="grid gallery-grid">
      {items.map((item, index) => {
        const mode = item.displayMode ?? 'auto';
        const mime = item.image?.mime?.toLowerCase() ?? '';
        const isGif =
          mode === 'gif' || (mode === 'auto' && (mime === 'image/gif' || item.image.url?.toLowerCase().endsWith('.gif')));
        const src = item.image?.formats?.medium?.url ?? item.image.url;
        const srcset = isGif
          ? undefined
          : [
              item.image.formats?.thumbnail?.url ? `${item.image.formats.thumbnail.url} 150w` : null,
              item.image.formats?.small?.url ? `${item.image.formats.small.url} 320w` : null,
              item.image.formats?.medium?.url ? `${item.image.formats.medium.url} 640w` : null,
              item.image.url ? `${item.image.url} ${item.image.width ?? 1024}w` : null,
            ]
              .filter(Boolean)
              .join(', ');
        const alt = item.alt ?? item.image.alternativeText ?? '';
        return (
          <figure class="gallery-item" key={item.image?.url ?? `gallery-${index}`}>
            <img
              src={src}
              srcset={srcset}
              sizes="(max-width: 600px) 50vw, 25vw"
              alt={alt}
              loading="lazy"
              decoding="async"
              data-animated={isGif ? 'true' : 'false'}
            />
          </figure>
        );
      })}
    </div>
  </section>
)}

<style>
  .gallery-card {
    gap: 0.75rem;
  }

  .gallery-grid {
    gap: 0.75rem;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    max-width: min(100%, 44rem);
    margin: 0 auto;
  }

  :global(.gallery-item) {
    margin: 0;
    display: grid;
    gap: 0.5rem;
  }

  :global(.gallery-item img) {
    width: 100%;
    height: auto;
    border-radius: 0.75rem;
    object-fit: cover;
    display: block;
    aspect-ratio: 4 / 3;
  }

</style>
