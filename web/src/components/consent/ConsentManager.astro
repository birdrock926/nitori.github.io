<div class="card consent-banner" id="consent-banner" role="dialog" aria-modal="true" aria-labelledby="consent-title">
  <h2 id="consent-title" class="consent-banner__title">クッキーの利用について</h2>
  <p class="muted consent-banner__description">
    パフォーマンス改善と広告配信のためにクッキーを利用します。設定はいつでも変更できます。
  </p>
  <div class="consent-banner__actions">
    <button id="consent-accept" class="consent-button consent-button--primary" type="button">同意する</button>
    <button id="consent-deny" class="consent-button" type="button">拒否する</button>
  </div>
</div>
<script is:inline>
  const banner = document.getElementById('consent-banner');
  const acceptBtn = document.getElementById('consent-accept');
  const denyBtn = document.getElementById('consent-deny');
  const STORAGE_KEY = 'consent-mode';

  const applyConsent = (mode) => {
    if (!window.gtag) return;
    window.gtag('consent', 'update', mode);
  };

  const showBanner = () => {
    banner?.style.setProperty('display', 'grid');
  };

  const hideBanner = () => {
    banner?.style.setProperty('display', 'none');
  };

  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    applyConsent(JSON.parse(saved));
  } else {
    showBanner();
  }

  acceptBtn?.addEventListener('click', () => {
    const consent = {
      ad_storage: 'granted',
      analytics_storage: 'granted',
    };
    applyConsent(consent);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(consent));
    hideBanner();
  });

  denyBtn?.addEventListener('click', () => {
    const consent = {
      ad_storage: 'denied',
      analytics_storage: 'denied',
    };
    applyConsent(consent);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(consent));
    hideBanner();
  });
</script>
