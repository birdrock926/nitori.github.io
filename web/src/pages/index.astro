---
import BaseLayout from '@layouts/BaseLayout.astro';
import Hero from '@components/Hero.astro';
import PostCard from '@components/PostCard.astro';
import Ranking from '@components/Ranking.astro';
import InlineAd from '@components/ads/InlineAd.astro';
import { getLatestPosts, getRanking } from '@lib/strapi';
import { ADSENSE } from '@config/site';

const posts = await getLatestPosts(12);
const featured = posts[0];
const secondary = posts.slice(1, 3);
const rest = posts.slice(3);
const ranking = await getRanking();
---
<BaseLayout title="ゲームニュース速報" description="ゲーム最新ニュースと配信まとめを最速でお届け" canonical={Astro.url.href}>
  {featured && secondary.length > 0 && <Hero featured={featured} secondary={secondary} />}
  <section style="margin-top: 3rem; display: grid; gap: 2rem;">
    <h2 style="margin: 0;">最新ニュース</h2>
    <div class="grid posts">
      {rest.map((post) => (
        <PostCard post={post} />
      ))}
    </div>
  </section>
  <InlineAd slot={ADSENSE.slots.feed} />
  <section style="margin-top: 3rem; display: grid; gap: 2rem;">
    <h2 style="margin: 0;">人気ランキング</h2>
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));">
      <Ranking title="24時間" items={ranking.slice(0, 5)} />
      <Ranking title="7日間" items={ranking.slice(5, 10)} />
    </div>
  </section>
</BaseLayout>
